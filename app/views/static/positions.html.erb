<% content_for(:title) { "Positions Trainer" } %>

<div class="positions-index container">

  <div class="new-position">

    <h2>Create a position</h2>

    <div class="description">
      Paste a FEN below to create a position for practicing. Save the url to share it <br>
    </div>

    <% if current_user %>

      <form action="/positions" method="POST">
        <%= hidden_field_tag :authenticity_token, form_authenticity_token %>

        <div class="small-instructions">
          You can use this
          <a href="https://en.lichess.org/editor/8/8/8/8/8/8/8/8_w_-_-"
             target="_blank">board editor</a>
          to find the FEN of a position
        </div>
        <input type="text" placeholder="ex. 8/8/1KP5/3r4/8/8/8/k7 w - -"
               class="text-input fen-input"
               name="position[fen]">
        <span class="play-to">Play to</span>
        <select name="position[goal]" class="position-goal">
          <option value="win">Win</option>
          <option value="draw">Draw</option>
        </select>

        <input type="text" name="position[name]" class="text-input name-input"
               placeholder="Name your position (optional)">

        <div class="submit">
          <button class="button save">Create position</button>
          <span class="error-message invisible"></span>
        </div>
      </form>

    <% else %>

      <form action="/position" method="GET">
        <input type="text" name="fen" placeholder="ex. 8/8/1KP5/3r4/8/8/8/k7 w - -"
               class="text-input fen-input">
        <span class="play-to">Play to</span>
        <select name="goal" class="position-goal">
          <option value="win">Win</option>
          <option value="draw">Draw</option>
        </select>
        <div class="submit">
          <input type="submit" value="Create position" class="button">
          <span class="error-message invisible"></span>
        </div>
      </form>

    <% end %>

  </div>

  <% if current_user&.positions.present? %>

    <h2>My positions</h2>

    <p class="description">
      Choose a position to play or edit it
    </p>

    <div class="positions">
      <% current_user.positions.order('id DESC').each do |position| %>
        <%= linked_position_miniboard position %>
      <% end %>
    </div>

  <% else %>

    <h2>Position trainer</h2>

    <div class="positions">

      <p class="description">
        Choose from a list of positions to go train yourself at playing it correctly!
      </p>

      <div class="examples">
        <%= linked_miniboard "Lucena position", "3K4/3P1k2/8/8/8/8/4R3/2r5 w - -", "win" %>
        <%= linked_miniboard "Philidor position", "6R1/4k2r/8/3KP3/8/8/8/8 b - -", "draw", 11 %>
        <%= linked_miniboard "Vancura position", "R7/6k1/P4r2/1K6/8/8/8/8 b - -", "draw", 11 %>

        <%= linked_miniboard "KBB vs K checkmate", "8/8/4k3/8/8/2K2B2/5B2/8 w - -", "win" %>
        <%= linked_miniboard "KBN vs K checkmate", "4k3/8/8/8/8/8/8/4KBN1 w - -", "win" %>
        <%= linked_miniboard "KQ vs KR checkmate", "8/3k4/4r3/8/8/1Q6/3K4/8 w - -", "win" %>

        <%= linked_miniboard "Distant opposition", "8/8/4k3/8/8/8/3KP3/8 b - -", "draw", 11 %>
        <%= linked_miniboard "Triangulation", "8/1p1k4/1P6/2PK4/8/8/8/8 w - -", "win", 11 %>
        <%= linked_miniboard "Reti's idea", "7K/8/k1P5/7p/8/8/8/8 w - -", "draw" %>
      </div>

    </div>

  <% end %>

</div>
